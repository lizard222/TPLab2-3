{% extends 'store/base.html' %}

{% block content %}
<h2>üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h2>

{% if cart_items %}
<div class="cart-summary">
    <p><strong>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤:</strong> {{ total_quantity }}</p>
    <p><strong>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {{ total_price|floatformat:2 }} —Ä—É–±.</p>
</div>

<div class="cart-items">
    {% for item in cart_items %}
    <div class="cart-item">
        <div class="cart-item-image">
            {% if item.product.image %}
            <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="product-image">
            {% else %}
            <div class="product-image-placeholder">
                üõ°Ô∏è
            </div>
            {% endif %}
        </div>
        
        <div class="cart-item-info">
            <h3>{{ item.product.name }}</h3>
            <p class="faction">{{ item.product.faction.name }}</p>
            <p class="type">{{ item.product.get_product_type_display }}</p>
            
            <div class="cart-item-controls">
                <form method="post" action="{% url 'update_cart_quantity' item.id %}" class="quantity-form">
                    {% csrf_token %}
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                    <input type="number" name="quantity" value="{{ item.quantity }}" min="1" max="99" class="quantity-input">
                    <button type="submit" class="btn btn-update">–û–±–Ω–æ–≤–∏—Ç—å</button>
                </form>
                
                <form method="post" action="{% url 'remove_from_cart' item.id %}" class="remove-form">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-remove">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                </form>
            </div>
        </div>
        
        <div class="cart-item-price">
            <p class="price">{{ item.total_price|floatformat:2 }} —Ä—É–±.</p>
            <p class="unit-price">{{ item.product.get_discounted_price|floatformat:2 }} —Ä—É–±. √ó {{ item.quantity }}</p>
        </div>
    </div>
    {% endfor %}
</div>

<div class="cart-actions">
    <a href="{% url 'product_list' %}" class="btn btn-return">‚Üê –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏</a>
    <button class="btn btn-checkout">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
</div>

{% else %}
<div class="empty-cart">
    <p>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.</p>
    <a href="{% url 'product_list' %}" class="btn">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–æ–∫—É–ø–∫–∞–º</a>
</div>
{% endif %}
{% endblock %}