{% extends 'store/base.html' %}

{% block content %}
<div class="faction-header">
    {% if selected_faction.logo %}
    <img src="{{ selected_faction.logo.url }}" alt="{{ selected_faction.name }}" class="faction-header-logo">
    {% endif %}
    <div class="faction-header-info">
        <h2>–ê—Ä–º–∏—è {{ selected_faction.name }}</h2>
        <p class="faction-description">{{ selected_faction.description }}</p>
        <a href="{% url 'product_list' %}" class="btn-return">‚Üê –í—Å–µ —Ñ—Ä–∞–∫—Ü–∏–∏</a>
    </div>
</div>

<div class="filters">
    <h3>–¢–∏–ø—ã —Ç–æ–≤–∞—Ä–æ–≤:</h3>
    <a href="?faction={{ selected_faction.id }}" 
       class="btn {% if not current_product_type %}btn-active{% endif %}">
        –í—Å–µ —Ç–æ–≤–∞—Ä—ã
    </a>
    <a href="?faction={{ selected_faction.id }}&type=MINIATURE" 
       class="btn {% if current_product_type == 'MINIATURE' %}btn-active{% endif %}">
        –ú–∏–Ω–∏–∞—Ç—é—Ä—ã
    </a>
    <a href="?faction={{ selected_faction.id }}&type=STARTER_SET" 
       class="btn {% if current_product_type == 'STARTER_SET' %}btn-active{% endif %}">
        –°—Ç–∞—Ä—Ç–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã
    </a>
    <a href="?faction={{ selected_faction.id }}&type=PAINT" 
       class="btn {% if current_product_type == 'PAINT' %}btn-active{% endif %}">
        –ö—Ä–∞—Å–∫–∏
    </a>
    <a href="?faction={{ selected_faction.id }}&type=ACCESSORY" 
       class="btn {% if current_product_type == 'ACCESSORY' %}btn-active{% endif %}">
        –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã
    </a>
</div>

<div class="products">
    {% for product in products %}
    <div class="product-card">
        {% if product.image %}
        <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image">
        {% else %}
        <div class="product-image-placeholder">
            üõ°Ô∏è
        </div>
        {% endif %}
        
        <div class="product-info">
            <h3>{{ product.name }}</h3>
            <p class="type">{{ product.get_product_type_display }}</p>
            
            {% if product.get_discounted_price != product.price %}
            <p class="price">
                <span class="old-price">{{ product.price }} —Ä—É–±.</span>
                <span class="new-price">{{ product.get_discounted_price|floatformat:2 }} —Ä—É–±.</span>
            </p>
            {% else %}
            <p class="price">{{ product.price }} —Ä—É–±.</p>
            {% endif %}
            
            {% if product.is_preorder %}
            <span class="preorder">–ü—Ä–µ–¥–∑–∞–∫–∞–∑</span>
            {% endif %}
            
            <form method="post" action="{% url 'add_to_cart' product.id %}">
                {% csrf_token %}
                <button type="submit">–í –∫–æ—Ä–∑–∏–Ω—É</button>
            </form>
        </div>
    </div>
    {% empty %}
    <p>–î–ª—è —ç—Ç–æ–π —Ñ—Ä–∞–∫—Ü–∏–∏{% if current_product_type %} –∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ —Ç–æ–≤–∞—Ä–æ–≤{% endif %} –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤.</p>
    {% endfor %}
</div>
{% endblock %}